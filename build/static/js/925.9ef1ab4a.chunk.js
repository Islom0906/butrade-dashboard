"use strict";(self.webpackChunkbutrade=self.webpackChunkbutrade||[]).push([[925],{84268:(e,t,s)=>{s.d(t,{A:()=>l});s(65043);var a=s(50289),i=s(33307),r=s(70579);const l=e=>{let{label:t,name:s,required:l,required_text:n,warning:u}=e;return(0,r.jsx)(a.A.Item,{label:u?(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:t}),(0,r.jsx)("br",{}),(0,r.jsx)("p",{children:u})]}):(0,r.jsx)("div",{children:t}),name:s,rules:[{required:l,message:n}],children:(0,r.jsx)(i.A,{})})}},14925:(e,t,s)=>{s.r(t),s.d(t,{default:()=>b});var a=s(65043),i=s(50289),r=s(48193),l=s(47419),n=s(11645),u=s(22895),o=s(89421),d=s(82907),c=s(59888),m=s(9772),p=s(73216),g=s(14556),h=s(68959),v=s(36213),f=s(84268),_=s(70579);const A={images:[],title_uz:"",title_ru:""},b=()=>{const[e]=i.A.useForm(),t=(0,p.Zp)(),{editId:s}=(0,g.d4)((e=>e.editData)),b=(0,g.wA)(),[x,j]=(0,a.useState)([]),{mutate:y,data:S,isLoading:w,isSuccess:F}=(0,d.useMutation)((e=>{let{url:t,formData:s}=e;return c.A.postData(t,s)}),{onSuccess:()=>{r.Ay.success("Success")},onError:e=>{for(let t in e.response.data)r.Ay.error("".concat(t,": ").concat(e.response.data[t][0]))}}),{mutate:E,data:D,isLoading:I,isSuccess:L}=(0,d.useMutation)((e=>{let{url:t,data:s}=e;return c.A.postData(t,s)}),{onSuccess:()=>{r.Ay.success("Success")},onError:e=>{for(let t in e.response.data)r.Ay.error("".concat(t,": ").concat(e.response.data[t][0]))}}),{isLoading:V,data:z,refetch:q,isSuccess:k}=(0,d.useQuery)(["edit-partners",s],(()=>c.A.getDataByID("/about/partners",s)),{enabled:!1}),{mutate:C,isLoading:M,data:T,isSuccess:O}=(0,d.useMutation)((e=>{let{url:t,data:s,id:a}=e;return c.A.editData(t,s,a)}),{onSuccess:()=>{r.Ay.success("Success")},onError:e=>{for(let t in e.response.data)r.Ay.error("".concat(t,": ").concat(e.response.data[t][0]))}}),{mutate:R}=(0,d.useMutation)((e=>{let{url:t,ids:s}=e;return c.A.deleteImages(t,s)}),{onSuccess:()=>r.Ay.success("Success"),onError:e=>r.Ay.error(e.message)});(0,a.useEffect)((()=>{O&&b({type:v.aT,payload:""}),(L||O)&&t("/partners")}),[D,T]),(0,a.useEffect)((()=>{""!==s&&q()}),[s]),(0,a.useEffect)((()=>{""===s&&e.setFieldsValue(A)}),[]),(0,a.useEffect)((()=>{const t=[];if(void 0!==z&&(null===z||void 0===z||z.partner_images.map((e=>{const s={uid:e.id,name:e.id,status:"done",url:e.image};t.push(s)}))),k){const s={title_uz:null===z||void 0===z?void 0:z.title_uz,title_ru:null===z||void 0===z?void 0:z.title_ru,images:t};j(t),e.setFieldsValue(s)}}),[z]);(0,a.useEffect)((()=>{const t=JSON.parse(localStorage.getItem("myFormValues"));t&&(t.images=[],e.setFieldsValue(t));const s=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",s),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",s)}}),[]),(0,a.useEffect)((()=>{if(F){var t,s,a;const i=[...x],r={uid:null===S||void 0===S||null===(t=S.images[0])||void 0===t?void 0:t.id,name:null===S||void 0===S||null===(s=S.images[0])||void 0===s?void 0:s.id,status:"done",url:null===S||void 0===S||null===(a=S.images[0])||void 0===a?void 0:a.url};i.push(r),e.setFieldsValue({images:[r]}),j(i)}}),[S]);return(0,_.jsx)("div",{children:I||V||M||w?(0,_.jsx)(m.HE,{}):(0,_.jsxs)(i.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:A,onFinish:e=>{const t=[];x.map((e=>{t.push(e.uid)}));const a={images:t,title_uz:e.title_uz,title_ru:e.title_ru,title_en:e.title_en,sub_title_uz:e.sub_title_uz,sub_title_ru:e.sub_title_ru,sub_title_en:e.sub_title_en};k?C({url:"/about/partners",data:a,id:s}):E({url:"/about/partners/",data:a})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,_.jsxs)(l.A,{gutter:20,children:[(0,_.jsx)(n.A,{span:24,children:(0,_.jsx)(f.A,{required:!0,required_text:"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u0432\u0435\u0441\u0442\u0438 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a",label:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a Ru",name:"title_ru"})}),(0,_.jsx)(n.A,{span:24,children:(0,_.jsx)(f.A,{required:!0,required_text:"Sarlavha kiritish kerak",label:"Sarlavha Uz",name:"title_uz"})})]}),(0,_.jsx)(l.A,{gutter:20,children:(0,_.jsx)(n.A,{span:24,children:(0,_.jsx)(i.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",name:"images",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,_.jsx)(h.A,{children:(0,_.jsx)(u.A,{maxCount:30,fileList:x,listType:"picture-card",onChange:e=>{let{fileList:t}=e;if(t.length<x.length)return;const s=new FormData;0!==t.length&&(s.append("uploaded_images",t[t.length-1].originFileObj),y({url:"/about/images/",formData:s}))},onPreview:async e=>{let t=e.url;t||(t=await new Promise((t=>{const s=new FileReader;s.readAsDataURL(e.originFileObj),s.onload=()=>t(s.result)})));const s=new Image;s.src=t;const a=window.open(t);null===a||void 0===a||a.document.write(s.outerHTML)},onRemove:t=>{const s=[];x.map((e=>{(null===e||void 0===e?void 0:e.uid)!==(null===t||void 0===t?void 0:t.uid)&&s.push(e)})),!s.length>0&&e.setFieldsValue({images:[]});const a={image_ids:[null===t||void 0===t?void 0:t.uid]};R({url:"/about/images/delete",ids:a}),j(s)},beforeUpload:()=>!1,children:x.length>29?"":"Upload"})})})})}),(0,_.jsx)(o.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:k?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=925.9ef1ab4a.chunk.js.map